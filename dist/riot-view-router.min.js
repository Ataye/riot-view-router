!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Router",[],e):"object"==typeof exports?exports.Router=e():t.Router=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="dist/",e(e.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);e.default={install:function(t,e,n){var o=new r.Router(t,e,n);return t.mixin({router:o}),o}},t.exports=e.default},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Router=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(2),a=n(3),s=n(4),u=n(5),l=n(6);e.Router=function(){function t(e,n,o){r(this,t);var c=this;c.constants=a.Constants,c.version=i.version,c.settings={},c.$riot=e,c.$logger=new s.Logger(c),c.$tools=new u.Tools(c),c.$utils=new l.Utils(c),c.$riot.observable(c),Object.defineProperty(c,"location",{get:function(){return{hash:window.location.hash,href:window.location.href}},set:function(t){window.history.pushState(null,null,t)}}),c.running=!1;var f=["default"],g=["debugging","fallback","href","fragments","marker","titleRoot"],h=f.concat(g);for(var d in n)if(-1===h.indexOf(d))throw Error('Unknown setting "'+d+'" is not supported');if(f.forEach(function(t){if(void 0===n[t])throw ReferenceError('Required setting "'+t+'" not specified')}),n.default.indexOf(":")>-1)throw Error("Default state route cannot take variable parameters");for(var p in c.settings){var v=c.constants.regex.settings[p];if(v&&!p.match(v))throw Error('Setting "'+p+'" has an invalid value of "'+n[p]+'"')}if(c.settings=Object.assign({},n),c.settings.debugging=c.settings.debugging||!1,c.settings.fragments=c.settings.fragments||!0,c.settings.marker=c.settings.marker||c.constants.defaults.marker,c.settings.href&&-1==c.location.href.indexOf(c.settings.href))throw Error("Defined href not found within location context");c.settings.href=c.settings.href||c.location.href.split(c.constants.defaults.hash)[0],c.settings.href.endsWith("/")||(c.settings.href=c.settings.href+"/");var m=["name","route","tag"];if(o=Array.isArray(o)?o.map(function(t){return Object.assign({},t)}):[Object.assign({},state)],m.forEach(function(t){o.forEach(function(e){if(!e[t])throw ReferenceError('Required state option "'+t+'" not specified')})}),o.forEach(function(t){for(var e in t){var n=c.constants.regex.state[e];if(n&&!t[e].match(n))throw Error('State "'+t.name+'" property "'+e+'" has an invalid value of "'+t[e]+'"')}}),o.forEach(function(t){t.route=c.$utils.splitRoute(t.route)}),c.states=o,!c.$utils.stateByName(c.settings.default))throw Error('State "'+c.settings.default+'" not found in specified states');if(c.settings.fallback){if(!c.$utils.stateByName(c.settings.fallback))throw Error('Fallback state "'+c.settings.fallback+'" not found in specified states')}else c.$logger.warn('Fallback state not specified, defaulting to "'+c.settings.default+'"'),c.settings.fallback=c.settings.default}return o(t,[{key:"navigate",value:function(t,e){var n=this;return new Promise(function(r,o){if(!n.running)return n.$logger.warn("(navigate) Router has not yet been started"),o();n.location=n.settings.href+n.constants.defaults.hash+t;var i=setInterval(function(){n.location.hash==n.constants.defaults.hash+t&&(window.clearInterval(i),n.trigger("navigation",{route:t}),e?r():n.push().then(function(){return r()}))},n.constants.intervals.navigate);setTimeout(o,n.constants.defaults.timeout)})}},{key:"push",value:function(t,e){var n=this;return new Promise(function(r){if(!n.running)return n.$logger.error("(push) Router has not yet been started"),reject();if(t)var o=n.$utils.stateByName(t);else{var o=n.$utils.stateByRoute();e=n.$utils.extractRouteVars(o)}if(n.location.hash.split(n.constants.defaults.hash)[1]!==o.route.route){if(!o.route.variables.length)return n.navigate(o.route.route),r();n.$logger.warn("(push) State does not match current route."),n.$logger.warn("(push) Could not re-route due to route variables.")}n.$state&&n.$state.onLeave&&n.$state.onLeave(o),n.$tools.transition(o,e),o.onEnter&&o.onEnter(o),n.$state=o,n.trigger("push"),r()})}},{key:"start",value:function(){var t=this;return new Promise(function(e,n){if(t.running)t.$logger.error("(start) Router already running"),n();else{var r=function(){var r=window.setInterval(function(){var n=document.querySelector(t.settings.marker)||document.querySelector("["+t.settings.marker+"]");n&&(t.context=n,t.push(),window.onhashchange=function(){return t.push()},window.clearInterval(r),t.trigger("start"),e())},t.constants.intervals.start);setTimeout(n,t.constants.defaults.timeout)};t.running=!0,2!==t.location.hash.split(t.constants.defaults.hash).length?t.navigate(t.$utils.stateByName(t.settings.default).route.route,!0).then(r):r()}})}},{key:"stop",value:function(){var t=this;return new Promise(function(e,n){t.running||(t.$logger.error("(stop) Router was not running"),n()),t.running=!1,delete window.onhashchange,t.trigger("stop"),e()})}},{key:"reload",value:function(){var t=this;return new Promise(function(e,n){if(!t.running)return t.$logger.error("(reload) Router has not yet been started"),n();t.push().then(function(){t.trigger("reload"),e()})})}}]),t}()},function(t,e){t.exports={name:"riot-view-router",version:"0.0.8",description:"Lightweight, extensive riot.js router for tag views.",main:"dist/riot-view-router.js",scripts:{"build:prod":"node_modules/.bin/cross-env NODE_ENV=production node_modules/.bin/webpack --config build/webpack.conf.js","build:dev":"node_modules/.bin/webpack --config build/webpack.conf.js",build:"npm run build:dev && npm run build:prod",lint:"node_modules/.bin/eslint src/**.js","test:unit":"node_modules/.bin/jasmine test/unit/spec.*.js","test:e2e":"node_modules/.bin/karma start test/karma.conf.js",test:"npm run lint && npm run test:unit && npm run test:e2e"},repository:{type:"git",url:"git+https://github.com/neetjn/riot-view-router.git"},keywords:["riot","riot.js","javascript","route","tag"],author:"John Nolette",license:"MIT",bugs:{url:"https://github.com/neetjn/riot-view-router/issues"},homepage:"https://neetjn.github.io/riot-view-router/",devDependencies:{"babel-core":"^6.26.0","babel-eslint":"^7.2.3","babel-loader":"^7.1.2","babel-plugin-add-module-exports":"^0.2.1","babel-preset-env":"^1.6.1","cross-env":"^5.1.0",electron:"^1.7.9",eslint:"^4.9.0","eslint-plugin-riot":"^0.1.7",jasmine:"2.5.2",karma:"^1.7.1","karma-coverage":"^1.1.1","karma-electron":"^5.2.1","karma-jasmine":"^1.1.0","karma-riot":"^2.0.0","random-js":"1.0.8",riot:"^3.7.3",webpack:"^3.8.1"},dependencies:{}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Constants={defaults:{hash:"#!",marker:"r-view",anchorMarker:"r-sref",timeout:5e3},regex:{settings:{default:/[a-zA-Z0-9]/g,fallback:/[a-zA-Z0-9]/g,href:/(www|http:|https:)+[^\s]+[\w]/g,marker:/[a-zA-Z\-]*/g},state:{name:/[a-zA-Z0-9]/g,route:/^\/(?::?[a-zA-Z0-9]+\/?)*$/g},misc:{routeVariable:/(:(?!qargs)[a-zA-Z]*)/g}},intervals:{start:10,navigate:50,fragments:250},waits:{fragments:2e3},events:{supported:["start","stop","reload","navigation","push","transition"],delay:0}}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.Logger=function(){function t(e){r(this,t),this.$router=e,this.logs=[],Object.defineProperty(this,"time",{get:function(){return(new Date).getTime()}})}return o(t,[{key:"_format",value:function(t,e){return"["+new Date(e).toString()+']: (riot-view-router) "'+t+'"'}},{key:"$get",value:function(t){return this.logs.filter(function(e){return!t||e.type==t})}},{key:"log",value:function(t){var e=this.time;this.$router.settings.debugging&&console.log(this._format(t,e)),this.logs.push({type:"general",message:t,timestamp:e})}},{key:"warn",value:function(t){var e=this.time;this.$router.settings.debugging&&console.warn(this._format(t,e)),this.logs.push({type:"warning",message:t,timestamp:e})}},{key:"error",value:function(t){var e=this.time;this.$router.settings.debugging&&console.error(this._format(t,e)),this.logs.push({type:"critical",message:t,timestamp:e})}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.Tools=function(){function t(e){r(this,t),this.$router=e}return o(t,[{key:"transition",value:function(t,e){var n=this.$router;return new Promise(function(r){if(n.$state){var o=riot.util.vdom.find(function(t){return t.root.localName==n.$state.tag});o||(n.$logger.error("(transition) Could not find a matching tag to unmount"),reject()),o.unmount()}var i=document.createElement(t.tag);if(n.context.appendChild(i),e){var a={};e.forEach(function(t){a[t.name]=t.value}),a.qargs=e._query;var s=n.$riot.mount(t.tag,a);if(t.title){var u=n.settings.titleRoot?n.settings.titleRoot+" - "+t.title:t.title;e.forEach(function(t){return u=u.replace("<"+t.name+">",t.value)}),document.title=u}}else var s=n.$riot.mount(t.tag);if(s[0].on("updated",function(){n.running&&document.querySelectorAll("["+n.constants.defaults.anchorMarker+"]").forEach(function(t){t.onclick=function(){var e=t.getAttribute(n.constants.defaults.anchorMarker);if(n.$utils.stateByName(e)){var r=n.$utils.stateByName(e);r.route.variables.length?n.$logger.error("(transition) Could not navigate to state due to expected route variables."):n.navigate(r.route.route)}else n.navigate(e)}})}),s[0].trigger("updated"),n.settings.fragments){var l=n.location.hash.split(n.constants.defaults.hash).join("").split("#");if(2===l.length)var c=0,f=setInterval(function(){c+=1,document.querySelector("#"+l[1])?(document.querySelector("#"+l[1]).scrollIntoView(),n._dispatch("transition",{state:t}).then(r).catch(r),clearInterval(f)):c*n.constants.intervals.fragments>=n.constants.waits.fragments&&(n.$logger.error('(transition) Fragment identifier "#'+l[1]+'" not found.'),n._dispatch("transition",{state:t}).then(r).catch(r),clearInterval(f))},n.constants.intervals.fragments)}else n._dispatch("transition",{state:t}).then(r).catch(r)})}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.Utils=function(){function t(e){r(this,t),this.$router=e}return i(t,[{key:"stateByName",value:function(t){return this.$router.states.find(function(e){return t==e.name})}},{key:"splitRoute",value:function(t){var e=this.$router;if(!t.match(e.constants.regex.state.route))throw Error('Route "'+t+'" did not match expected route format');var n=t.split("/").slice(1),r=n.filter(function(t){return t.match(e.constants.regex.misc.routeVariable)}).map(function(t){return{name:t.split("").slice(1).join(""),position:n.indexOf(t)}});return r.forEach(function(e){if(r.filter(function(t){return t==e}).length>1)throw Error('Found duplicate route variable pattern\n\t "'+t+'"')}),{route:t,pattern:n,variables:r}}},{key:"stateByRoute",value:function(){var t=this.$router,e=t.location.hash.split(t.constants.defaults.hash);2==e.length?(t.settings.fragments&&(e=e.join("").split("#")[0].split()),e=e.join("").split("?")[0].split("/").slice(1)):e=["/"];var n=t.states.find(function(t){var n=t.route;if(e.length==n.pattern.length){for(var r in e){var i=function(t){if(e[t]!==n.pattern[t]&&"*"!==n.pattern[t]&&!n.variables.find(function(e){return e.position==t}))return{v:!1}}(r);if("object"===(void 0===i?"undefined":o(i)))return i.v}return!0}});return n||(t.$logger.warn("Route was not matched, defaulting to fallback state"),this.stateByName(t.settings.fallback))}},{key:"extractRouteVars",value:function(t){var e=this.$router,n=t.route.variables.map(function(t){return Object.assign({},t)}),r=e.location.hash.split(e.constants.defaults.hash),o=[];return 2==r.length?(e.settings.fragments?(r=r.join("").split("#")[0].split(),o=e.location.hash.split("#")[1].split("?")):o=e.location.hash.split("?"),r=r.join("").split("?")[0].split("/").slice(1),n.forEach(function(t){t.value=decodeURI(r[t.position])}),2==o.length&&(n._query={},o[1].split("&").forEach(function(t){t=t.split("="),n._query[t[0]]=decodeURI(t[1])})),n):[]}}]),t}()}])});